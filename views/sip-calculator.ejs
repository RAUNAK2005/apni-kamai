<%- include('partials/header') %>
<section class="apni-section">
  <h2>SIP Calculator</h2>
  <div class="apni-widget">
    <input type="number" id="sip-amount" placeholder="Monthly (₹)" class="apni-input">
    <input type="number" id="sip-rate" placeholder="Rate (%)" class="apni-input">
    <input type="number" id="sip-term" placeholder="Term (Years)" class="apni-input">
    <button onclick="calculateSIP()" class="apni-btn">Calculate</button>
    <p>Invested: <span id="sip-invested">-</span></p>
    <p>Gained: <span id="sip-gained">-</span></p>
    <p>Total: <span id="sip-total">-</span></p>
    <div class="apni-chart">
      <canvas id="sipChart"></canvas>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let sipChart;
  
  function calculateSIP() {
    const monthlyAmount = parseFloat(document.getElementById('sip-amount').value);
    const rate = parseFloat(document.getElementById('sip-rate').value);
    const years = parseFloat(document.getElementById('sip-term').value);
    
    if (isNaN(monthlyAmount) || isNaN(rate) || isNaN(years)) {
      alert('Please enter valid numbers');
      return;
    }
    
    const monthlyRate = rate / 12 / 100;
    const months = years * 12;
    const totalInvested = monthlyAmount * months;
    
    // Calculate future value using SIP formula
    const futureValue = monthlyAmount * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate) * (1 + monthlyRate);
    const totalGained = futureValue - totalInvested;
    
    document.getElementById('sip-invested').textContent = '₹' + totalInvested.toFixed(2);
    document.getElementById('sip-gained').textContent = '₹' + totalGained.toFixed(2);
    document.getElementById('sip-total').textContent = '₹' + futureValue.toFixed(2);
    
    // Update the chart
    updateChart(totalInvested, totalGained);
  }
  
  function updateChart(invested, gained) {
    // Destroy previous chart if it exists
    if (sipChart) {
      sipChart.destroy();
    }
    
    const ctx = document.getElementById('sipChart').getContext('2d');
    sipChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Invested Amount', 'Wealth Gained'],
        datasets: [{
          data: [invested, gained],
          backgroundColor: ['#36A2EB', '#FF6384'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'right',
            labels: {
              color: document.body.classList.contains('light-mode') ? '#0a192f' : '#e0e0ff'
            }
          },
          title: {
            display: true,
            text: 'SIP Investment Breakdown',
            color: document.body.classList.contains('light-mode') ? '#0a192f' : '#e0e0ff'
          }
        }
      }
    });
  }
</script>
<%- include('partials/footer') %>